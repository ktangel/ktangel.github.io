(window.webpackJsonp=window.webpackJsonp||[]).push([[120],{445:function(s,t,a){"use strict";a.r(t);var e=a(33),n=Object(e.a)({},(function(){var s=this,t=s.$createElement,a=s._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[a("h1",{attrs:{id:"gogs"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#gogs"}},[s._v("#")]),s._v(" Gogs")]),s._v(" "),a("h2",{attrs:{id:"简介"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#简介"}},[s._v("#")]),s._v(" 简介")]),s._v(" "),a("p",[s._v("gogs是一个基于go语言的易安装、跨平台、轻量级的git服务")]),s._v(" "),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[s._v("#")]),s._v(" 安装")]),s._v(" "),a("h3",{attrs:{id:"先创建一个git用户"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#先创建一个git用户"}},[s._v("#")]),s._v(" 先创建一个git用户")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#Ubuntu")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" adduser --disabled-login --gecos "),a("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Gogs'")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("## Centos 7之后是不支持--disabled-login参数")]),s._v("\nadduser \n\n")])])]),a("p",[s._v("然后登陆git用户，在git用户环境下继续下面的安装。")]),s._v(" "),a("h3",{attrs:{id:"二进制包"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二进制包"}},[s._v("#")]),s._v(" 二进制包")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://gogs.io/docs/installation/install_from_binary",target:"_blank",rel:"noopener noreferrer"}},[s._v("参考"),a("OutboundLink")],1),s._v("\n根据所用平台去"),a("a",{attrs:{href:"https://dl.gogs.io/",target:"_blank",rel:"noopener noreferrer"}},[s._v("官网下载"),a("OutboundLink")],1),s._v("编译好的程序包")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#登录 git帐户")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("su")]),s._v(" - "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("git")]),s._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载安装包")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://cdn.gogs.io/0.11.91/gogs_0.11.91_linux_amd64.tar.gz\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("tar")]),s._v(" -xvf\n\n")])])]),a("h3",{attrs:{id:"包管理安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#包管理安装"}},[s._v("#")]),s._v(" 包管理安装")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://packager.io/gh/gogs/gogs/builds/241/install/centos-7",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方给的包管理安装文档"),a("OutboundLink")],1)]),s._v(" "),a("p",[s._v("这个包管理不是官方提供的，官方不对包的安全性负责。建议二进制包安装。")]),s._v(" "),a("h3",{attrs:{id:"源码安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#源码安装"}},[s._v("#")]),s._v(" 源码安装")]),s._v(" "),a("p",[s._v("官方给的方法太慢太没效率了，因为下载和编译速度都蛮花时间。所以还是建议二进制包安装。")]),s._v(" "),a("h2",{attrs:{id:"配置"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置"}},[s._v("#")]),s._v(" 配置")]),s._v(" "),a("h3",{attrs:{id:"建立数据库"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#建立数据库"}},[s._v("#")]),s._v(" 建立数据库")]),s._v(" "),a("p",[s._v("可以直接执行"),a("code",[s._v("gogs/script/mysql.sql")]),s._v("脚本")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--- 这个脚本中有一条判断是否存在数据库gogs并删除，如果不是首次安装，请谨慎使用")]),s._v("\nsource "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("home"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("git"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("gogs"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("scripts"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),s._v("mysql"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),s._v("\n")])])]),a("p",[s._v("或者自己建立一个数据库")]),s._v(" "),a("div",{staticClass:"language-sql extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sql"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("CREATE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("DATABASE")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("IF")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("NOT")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("EXISTS")]),s._v(" gogs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" gogs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" storage_engine"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("INNODB")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),a("h3",{attrs:{id:"首次安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#首次安装"}},[s._v("#")]),s._v(" 首次安装")]),s._v(" "),a("p",[s._v("回到git用户环境，进入./gogs/ 项目文件夹。")]),s._v(" "),a("p",[s._v("服务默认是监听3000端口，如果启动失败请检查是否商品被占用")]),s._v(" "),a("p",[s._v("提前先把端口在防火墙中打开")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("firewall-cmd --zone"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("public --add-port"),a("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("3000")]),s._v("/tcp --permanent\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重启生效")]),s._v("\nfirewall-cmd --reload\n")])])]),a("p",[s._v("运行服务，如果启动失败请检查是否商品被占用")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("./gogs web\n")])])]),a("p",[s._v("运行网页访问3000端口，应该会出现首次安装时的配置页面。")]),s._v(" "),a("p",[s._v("这里注意下面几个配置项就行")]),s._v(" "),a("ul",[a("li",[s._v("数据库用户和密码")]),s._v(" "),a("li",[s._v("域名")]),s._v(" "),a("li",[s._v("应用 URL")]),s._v(" "),a("li",[s._v("端口号 3000")]),s._v(" "),a("li",[s._v("服务器和其它服务设置")]),s._v(" "),a("li",[s._v("管理员帐号设置")])]),s._v(" "),a("p",[s._v("然后点安装")]),s._v(" "),a("p",[s._v("这些选项想修改可以随时更改"),a("a",{attrs:{href:"#%E9%85%8D%E7%BD%AE%E6%96%87%E6%A1%A3%E8%AF%B4%E6%98%8E"}},[s._v("配置文件")]),a("code",[s._v("app.ini")]),s._v("也可以的。")]),s._v(" "),a("p",[s._v("如果想重新初始化安装，可以修改app.ini的"),a("code",[s._v("INSTALL_LOCK")]),s._v("为false。")]),s._v(" "),a("h3",{attrs:{id:"运行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#运行"}},[s._v("#")]),s._v(" 运行")]),s._v(" "),a("p",[s._v("手动运行")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[s._v("./gogs/gogs web\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更多参数")]),s._v("\n./gogs -h\nNAME:\n   Gogs - A painless self-hosted Git "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("service")]),s._v("\n\nUSAGE:\n   gogs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("global options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("command options"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("arguments"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),a("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\nVERSION:\n   "),a("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.11")]),s._v(".91.0811\n\nCOMMANDS:\n     web      Start web server\n     serv     This "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" should only be called by SSH shell\n     hook     Delegate commands to corresponding Git hooks\n     cert     Generate self-signed certificate\n     admin    Perform admin operations on "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v(" line\n     "),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v("   Import portable data as "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("local")]),s._v(" Gogs data\n     backup   Backup files and database\n     restore  Restore files and database from backup\n     help, h  Shows a list of commands or "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),s._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" one "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("command")]),s._v("\n\nGLOBAL OPTIONS:\n   --help, -h     show "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("help")]),s._v("\n   --version, -v  print the version\n")])])]),a("h3",{attrs:{id:"注册系统服务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#注册系统服务"}},[s._v("#")]),s._v(" 注册系统服务")]),s._v(" "),a("p",[s._v("切换至有root权限的用户。")]),s._v(" "),a("p",[s._v("直接将项目中的"),a("code",[s._v("scripts/systemd")]),s._v("目录里的服务文件"),a("code",[s._v("gogs.service")]),s._v("拷贝到用户服务目录"),a("code",[s._v("/usr/lib/systemd/system/")])]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" /home/git/gogs/scripts/systemd/gogs.service /usr/lib/systemd/system/\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭手动运行过的gogs")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("killall")]),s._v(" gogs\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 通过系统服务启动gogs")]),s._v("\nsystemctl start gogs\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看是否成功启动")]),s._v("\nsystemctl status gogs\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打开服务开机启动")]),s._v("\nsystemctl "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" gogs\n")])])]),a("div",{staticClass:"custom-block tip"},[a("p",[s._v("在centos中有时候会出现手动可以正常启动服务，而服务无法正常启动，这里面排查完权限问题依然存在的话，还有一个原因可能就是"),a("code",[s._v("Selinux防火墙")]),s._v("未关闭，尝试关闭后看能否解决")])]),s._v(" "),a("h3",{attrs:{id:"关闭selinux防火墙"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#关闭selinux防火墙"}},[s._v("#")]),s._v(" 关闭Selinux防火墙")]),s._v(" "),a("p",[s._v("执行"),a("code",[s._v("sestatus")]),s._v("查看当前状态，如果不为disabled\n可先执行"),a("code",[s._v("setenforce 0")]),s._v("临时关闭，然后尝试运行服务看是否正常。")]),s._v(" "),a("p",[s._v("如果正常，说明问题就出在这。然后彻底关闭Selinux防火墙")]),s._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/selinux/conf\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SELINUX=enforcing更改为SELINUX=disabled")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后重启生效")]),s._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[s._v("reboot")]),s._v("\n")])])]),a("h2",{attrs:{id:"配置文档说明"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#配置文档说明"}},[s._v("#")]),s._v(" 配置文档说明")]),s._v(" "),a("p",[s._v("用户自定义配置文件位于 ./gogs/custom/conf/app.ini")]),s._v(" "),a("div",{staticClass:"language-conf extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[s._v("APP_NAME = Gogs         # 进程名\nRUN_USER = git          # 运行用户\nRUN_MODE = prod         # 运行模式\n\n[database]\nDB_TYPE  = mysql            # 数据库类型\nHOST     = 127.0.0.1:3306   # 数据库地址和端口\nNAME     = gogs             # gogs存取的数据库名\nUSER     = root             # 登陆数据库用户\nPASSWD   = root123456       # 密码\nSSL_MODE = disable          # 是否使用ssh链接\nPATH     = data/gogs.db     # 数据库存放路径\n\n[repository]\nROOT = /home/git/gogs-repositories          # 仓库数据文件存放目录\n\n[server]\nDOMAIN           = cent8v.cn            # 域名，对应SSH clone地址\nHTTP_ADDR        = 127.0.0.1            # 监听地址，nginx建议 127.0.0.1，否则 0.0.0.0\nHTTP_PORT        = 3000                 # 服务监听端口\nROOT_URL         = http://cent8v.cn:3000/   # 仓库URL地址，对应HTTP clone地址\nDISABLE_SSH      = false                # 是否禁用SSH连接\nSSH_PORT         = 22                   # SSH服务端口\nSTART_SSH_SERVER = false                # 是否开启自建的SSH服务而非使用系统的\nOFFLINE_MODE     = false                # 离线模式，影响的是远程仓库的同步\n\n[mailer]\nENABLED = false                             # 邮件服务\n\n[service]\nREGISTER_EMAIL_CONFIRM = false              # 是否开启注册邮件通知\nENABLE_NOTIFY_MAIL     = false              # 是否开启邮件通知\nDISABLE_REGISTRATION   = false\nENABLE_CAPTCHA         = true\nREQUIRE_SIGNIN_VIEW    = true\n\n[picture]\nDISABLE_GRAVATAR        = false             # 禁用用户自定义头像\nENABLE_FEDERATED_AVATAR = false             # 开户用户上传用户头像\n\n[session]\nPROVIDER = file                             # 会话存储方式\n\n[log]\nMODE      = file                            # log存放方式\nLEVEL     = Info                            # logo信息显示级别\nROOT_PATH = /home/git/gogs/log              # log的存放目录\n\n[security]\nINSTALL_LOCK = true                         # 初始化安装锁定开关\nSECRET_KEY   = L4IHTplL0Dy91gX              # SECRET_KEY\n")])])]),a("h2",{attrs:{id:"问题"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题"}},[s._v("#")]),s._v(" 问题")]),s._v(" "),a("p",[s._v("遇到启动问题，可以根据Log查看相关错误日志，针对性地解决。")]),s._v(" "),a("p",[s._v("log默认存放在"),a("code",[s._v("./gogs/log")]),s._v("，或者你在安装的时候自己选择的相应目录里。")]),s._v(" "),a("p",[a("a",{attrs:{href:"https://blog.mynook.info/post/host-your-own-git-server-using-gogs/",target:"_blank",rel:"noopener noreferrer"}},[s._v("更多安装参考"),a("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=n.exports}}]);