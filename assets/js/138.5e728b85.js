(window.webpackJsonp=window.webpackJsonp||[]).push([[138],{467:function(e,t,a){"use strict";a.r(t);var n=a(33),s=Object(n.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"ssl"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#ssl"}},[e._v("#")]),e._v(" SSL")]),e._v(" "),a("h2",{attrs:{id:"open自建证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#open自建证书"}},[e._v("#")]),e._v(" open自建证书")]),e._v(" "),a("p",[e._v("生成私钥")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[e._v("openssl genrsa -out private.key "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1024")]),e._v("\n")])])]),a("p",[e._v("生成一个证书请求")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[e._v("openssl req -new -key private.key -out cert_req.csr\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 指定密钥密钥文件来生成一个ca请求")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 要求填入国家区域、公司名、域名、最后填密码")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 重要的是Common Name，填入与服务器域名或访问时的IP地址")]),e._v("\n")])])]),a("p",[e._v("将请求发给CA机构进行签名")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[e._v("openssl x509 -req -days "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("365")]),e._v(" -in cert_req.csr -signkey private.key -out server_cert.crt\n")])])]),a("p",[e._v("参数说明")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("参数")]),e._v(" "),a("th",[e._v("功能")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("req")]),e._v(" "),a("td",[e._v("此子命令指定我们要使用X.509证书签名请求（CSR）管理。“X.509”是SSL和TLS为其密钥和证书管理所遵循的公钥基础结构标准。我们想要创建一个新的X.509证书，所以我们使用这个子命令")])]),e._v(" "),a("tr",[a("td",[e._v("-x509")]),e._v(" "),a("td",[e._v("通过告诉实用程序我们要创建自签名证书而不是生成证书签名请求（通常会发生）来进一步修改上一个子命令")])]),e._v(" "),a("tr",[a("td",[e._v("-nodes")]),e._v(" "),a("td",[e._v("这告诉OpenSSL跳过用密码保护我们的证书的选项。当服务器启动时，我们需要Nginx能够在没有用户干预的情况下读取文件。密码短语会阻止这种情况发生，因为我们必须在每次重启后输入密码")])]),e._v(" "),a("tr",[a("td",[e._v("-days 365")]),e._v(" "),a("td",[e._v("此选项设置证书被视为有效的时间长度。我们在这里设置了一年")])])])]),e._v(" "),a("p",[e._v("最终生成文件：")]),e._v(" "),a("ul",[a("li",[e._v("cert_req.csr 请求")]),e._v(" "),a("li",[e._v("server_cert.crt 签名证书")]),e._v(" "),a("li",[e._v("private.key 密钥")])]),e._v(" "),a("p",[e._v("然后在nginx 的443配置中引用证书")]),e._v(" "),a("div",{staticClass:"language-conf extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("ssl_certificate         存放路径/server_cert.crt;\nssl_certificate_key     存放路径/private.key;\n")])])]),a("h2",{attrs:{id:"单域名证书申请"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#单域名证书申请"}},[e._v("#")]),e._v(" 单域名证书申请")]),e._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",[e._v("申请这类域名的途径很多，阿里云和腾讯云都有针对单域名的免费申请，有效期是1年，这种方式其实更省事些。")])]),e._v(" "),a("ul",[a("li",[e._v("certbot nginx插件申请")])]),e._v(" "),a("h2",{attrs:{id:"免费泛域名证书申请"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#免费泛域名证书申请"}},[e._v("#")]),e._v(" 免费泛域名证书申请")]),e._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",[e._v("泛域名申请只能通过DNS TXT记录的方式申请到，有效期3个月，到期需要手动操作配合更新DNS解析TXT记录续约，或者利用供应商提供的DNS SDK进行更新，其实相当于是重新颁发。")])]),e._v(" "),a("ul",[a("li",[a("p",[a("a",{attrs:{href:"#let-s-encrypt-auto%E7%94%B3%E8%AF%B7"}},[e._v("Let's Encrypt 方式")])])]),e._v(" "),a("li",[a("p",[a("a",{attrs:{href:"#certbot%E5%91%BD%E4%BB%A4%E8%A1%8C"}},[e._v("certbot命令行")])])])]),e._v(" "),a("h2",{attrs:{id:"let-s-encrypt-auto申请"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#let-s-encrypt-auto申请"}},[e._v("#")]),e._v(" Let's Encrypt-auto申请")]),e._v(" "),a("h3",{attrs:{id:"let-s-encrypt-介绍"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#let-s-encrypt-介绍"}},[e._v("#")]),e._v(" Let's Encrypt 介绍")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://link.jianshu.com/?t=https://letsencrypt.org",target:"_blank",rel:"noopener noreferrer"}},[e._v("Let's Encrypt"),a("OutboundLink")],1),e._v("是一个免费、开放，自动化的证书颁发机构，由 ISRG（Internet Security Research Group）运作。")]),e._v(" "),a("p",[e._v("ISRG 是一个关注网络安全的公益组织，其赞助商从非商业组织到财富100强公司都有，包括 Mozilla、Akamai、Cisco、Facebook，密歇根大学等等。ISRG 以消除资金，技术领域的障碍，全面推进加密连接成为互联网标配为自己的使命。")]),e._v(" "),a("p",[e._v("Let's Encrypt 项目于2012年由 Mozilla 的两个员工发起，2014年11年对外宣布公开，2015年12月3日开启公测。")]),e._v(" "),a("p",[e._v("Let's Encrypt 目前处于公测期间，文档，工具还不完善，请谨慎用于生产环境。")]),e._v(" "),a("h3",{attrs:{id:"let-s-encrypt-安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#let-s-encrypt-安装"}},[e._v("#")]),e._v(" Let's Encrypt 安装")]),e._v(" "),a("p",[e._v("Let's Encrypt 目前仅支持 Unix-like 系统，需要 Python 2.6 或 2.7，暂不支持 Python 3。")]),e._v(" "),a("p",[e._v("可以使用 pip 安装 Let's Encrypt 客户端，或到其 (wiki)[https://link.jianshu.com/?t=https://github.com/letsencrypt/letsencrypt/wiki/Packaging] 上查看已打包的各操作系统安装方式。")]),e._v(" "),a("p",[e._v("以官方推荐的 "),a("code",[e._v("letsencrypt-auto")]),e._v(" 脚本为例进行安装：")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("git")]),e._v(" clone https://github.com/letsencrypt/letsencrypt\n\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("cd")]),e._v(" letsencrypt\n\n$ ./letsencrypt-auto --help\n")])])]),a("h3",{attrs:{id:"let-s-encrypt-验证方式"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#let-s-encrypt-验证方式"}},[e._v("#")]),e._v(" Let's Encrypt 验证方式")]),e._v(" "),a("p",[e._v("Let's Encrypt 使用两种方式对申请的域名进行验证：")]),e._v(" "),a("p",[e._v("1、 手动验证 按照提示在申请证书的服务器上使用一个指定的URL提供一个指定的文件内容来进行验证，进行手动验证的服务器IP地址会被 Let's Encrypt 服务端记录在案。")]),e._v(" "),a("p",[e._v("2、 自动验证 在 目标服务器 （指域名解析对应的IP地址的服务器，下同）上运行客户端，并启动一个 80 或 443 端口进行自动验证。包括独立模式和其他web sever验证模式，在 Plugins 中详细解释")]),e._v(" "),a("h2",{attrs:{id:"certbot命令行"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#certbot命令行"}},[e._v("#")]),e._v(" certbot命令行")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://certbot.eff.org/lets-encrypt/centosrhel7-nginx",target:"_blank",rel:"noopener noreferrer"}},[e._v("certbot官网"),a("OutboundLink")],1)]),e._v(" "),a("h3",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[e._v("#")]),e._v(" 安装")]),e._v(" "),a("p",[e._v("在官网上可以通过选择不同的系统和环境来按提示完成安装；")]),e._v(" "),a("h3",{attrs:{id:"centos7"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#centos7"}},[e._v("#")]),e._v(" Centos7")]),e._v(" "),a("p",[e._v("需要root权限,下面的是官网推荐的安装。")]),e._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",[e._v("以这种方式安装的会提示依赖包问题，可以按后面的方法用pip方式安装解决")])]),e._v(" "),a("h4",{attrs:{id:"_1-添加yum-源并更新；"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-添加yum-源并更新；"}},[e._v("#")]),e._v(" 1. 添加yum 源并更新；")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm\nyum update\n")])])]),a("h4",{attrs:{id:"_2-开启可选通道"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-开启可选通道"}},[e._v("#")]),e._v(" 2. 开启可选通道")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("yum -y "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" yum-utils\nyum-config-manager --enable rhui-REGION-rhel-server-extras rhui-REGION-rhel-server-optional\n")])])]),a("h4",{attrs:{id:"_3-安装certbot"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-安装certbot"}},[e._v("#")]),e._v(" 3. 安装certbot")]),e._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",[e._v("强烈推荐以"),a("a",{attrs:{href:"#pip%E6%96%B9%E5%BC%8F%E5%AE%89%E8%A3%85certbot"}},[e._v("pip方式安装certbot")])])]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" certbot\n")])])]),a("p",[e._v("nginx")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" certbot python2-certbot-nginx\n")])])]),a("div",{staticClass:"custom-block warning"},[a("p",[e._v("提示，urllib3 模块问题，重新安装urllib3到指定版本：")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("pip uninstall urllib3\npip "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("urllib3")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("==")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1.21")]),e._v(".1\n")])])]),a("p",[e._v("再提示pyopenssl 问题：")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" -y openssl-devel\npip "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("cryptography")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("==")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2.3")]),e._v("\n")])])])]),e._v(" "),a("h3",{attrs:{id:"pip方式安装certbot"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#pip方式安装certbot"}},[e._v("#")]),e._v(" pip方式安装certbot")]),e._v(" "),a("p",[e._v("卸载yum安装的certbot和pyOpenSSL")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("yum remove certbot pyOpenSSL"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])])]),a("p",[e._v("升级pip")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("pip "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" --upgrade pip；\n")])])]),a("p",[e._v("pip安装certbot")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("pip "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" certbot\n")])])]),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[e._v("如果遇到到了Python.h或者pyconfig.h找不到的错误，")]),e._v(" "),a("p",[e._v("先安装Python的devel包后再重试安装certbot：")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v(" yum "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" -y python-devel\n pip "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" certbot\n")])])])]),e._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",{staticClass:"custom-block-title"},[e._v("提示找不到opensslv.h头文件")]),e._v(" "),a("p",[e._v("安装OpenSSL的devel包后再重试安装certbot：")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" -y openssl-devel\npip "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" certbot\n")])])])]),e._v(" "),a("h3",{attrs:{id:"certbot使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#certbot使用"}},[e._v("#")]),e._v(" certbot使用")]),e._v(" "),a("p",[e._v("有三种方式进行证书申请：")]),e._v(" "),a("div",{staticClass:"custom-block warning"},[a("p",[e._v("第一和第二种无法申请泛域名证书")])]),e._v(" "),a("h4",{attrs:{id:"一、客户端标准"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#一、客户端标准"}},[e._v("#")]),e._v(" 一、客户端标准")]),e._v(" "),a("p",[e._v("这种模式需要关闭占用80和442端口的web服务；")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("certbot certonly --standalone\n")])])]),a("h4",{attrs:{id:"二、网页路径"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#二、网页路径"}},[e._v("#")]),e._v(" 二、网页路径")]),e._v(" "),a("p",[e._v("加入现有web服务相对路径中，不影响现有服务运行；")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("certonly --webroot\n")])])]),a("h4",{attrs:{id:"三、dns验证"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#三、dns验证"}},[e._v("#")]),e._v(" 三、DNS验证")]),e._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",[e._v("这种方式可以申请泛域名证书")])]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" certbot certonly --preferred-challenges dns --manual -d yourdomain.com,*.yourdomain.com --server https://acme-v02.api.letsencrypt.org/directory\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 将*.yourdomain.com 替换成你的泛域名")]),e._v("\n")])])]),a("h3",{attrs:{id:"nginx插件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx插件"}},[e._v("#")]),e._v(" Nginx插件")]),e._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",[e._v("这种方式无法申请泛域名证书，但优点是使用方便，可设置自动定时续约服务，和客户端方式一样，中途会短暂停止nginx")])]),e._v(" "),a("h4",{attrs:{id:"nginx插件-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nginx插件-2"}},[e._v("#")]),e._v(" Nginx插件")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[e._v("yum "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("install")]),e._v(" certbot python2-certbot-nginx "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#如已安装cerbot，可省去certbot")]),e._v("\n")])])]),a("h4",{attrs:{id:"插件使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#插件使用"}},[e._v("#")]),e._v(" 插件使用")]),e._v(" "),a("div",{staticClass:"language-sh extra-class"},[a("pre",{pre:!0,attrs:{class:"language-sh"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 第一种，自动检查nginx配置中的域名，让你选择要申请哪一个，然后申请完后自动配置")]),e._v("\n\ncertbot --nginx\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 或者自己手动配置")]),e._v("\ncertbot --nginx certonly\n")])])]),a("h3",{attrs:{id:"定时续期证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#定时续期证书"}},[e._v("#")]),e._v(" 定时续期证书")]),e._v(" "),a("p",[e._v("定时任务")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("echo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("\"0 0,12 * * * root python -c 'import random; import time; time.sleep(random.random() * 3600)' && certbot renew\"")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("tee")]),e._v(" -a /etc/crontab "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" /dev/null\n")])])]),a("p",[e._v("如果你用的是nginx，可以加入重启nginx服务的命令")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("echo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("\"0 0,12 * * * root python -c 'import random; import time; time.sleep(random.random() * 3600)' && certbot renew --pre-hook 'service nginx stop' --post-hook 'service nginx start'\"")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("|")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("tee")]),e._v(" -a /etc/crontab "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v(" /dev/null\n")])])]),a("h3",{attrs:{id:"清除任务"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#清除任务"}},[e._v("#")]),e._v(" 清除任务")]),e._v(" "),a("p",[e._v("将"),a("code",[e._v("/etc/crontab")]),e._v(" 文件中最下面一行命令删除并保存")]),e._v(" "),a("h3",{attrs:{id:"插件的具体使用"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#插件的具体使用"}},[e._v("#")]),e._v(" 插件的具体使用")]),e._v(" "),a("h4",{attrs:{id:"webroot"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#webroot"}},[e._v("#")]),e._v(" webroot")]),e._v(" "),a("p",[e._v("一般需要使用的参数")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("certonly "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#只获取证书，不安装")]),e._v("\n--webroot "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("#定义使用的插件方法是webroot")]),e._v("\n--webroot-path "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 简写：-w 目录位置")]),e._v("\n-d "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 域名")]),e._v("\n\ncertbot certonly --webroot -w /var/www/example -d www.example.com -d example.com -w /var/www/other -d other.example.net -d another.other.example.net\n\n")])])]),a("p",[a("code",[e._v("-w")]),e._v("和"),a("code",[e._v("-d")]),e._v("配合使用，域名将使用最近的path，比如上面"),a("code",[e._v("/var/www/example")]),e._v(" 对应 前两个域名，"),a("code",[e._v("/var/www/other")]),e._v("对应后两个域名")]),e._v(" "),a("p",[e._v("验证的机制：")]),e._v(" "),a("p",[e._v("验证的时候会自动向"),a("code",[e._v("${webroot-path}/.well-known/acme-challenge")]),e._v("目录下写一个临时文件，然后会发送一个请求，去验证是否可以正常访问，访问的请求类似下面")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token number"}},[e._v("66.133")]),e._v(".109.36 - - "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),e._v("05/Jan/2016:20:11:24 -0500"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"GET /.well-known/acme-challenge/HGr8U1IeTW4kY_Z6UIyaakzOkyQgPr_7ArlLgtZE8SX HTTP/1.1"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("200")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("87")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"-"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"Mozilla/5.0 (compatible; Let\'s Encrypt validation server; +https://www.letsencrypt.org)"')]),e._v("\n")])])]),a("p",[e._v("所以我们本身有服务的情况下，比如使用的是nginx，那么我们需要添加如下配置")]),e._v(" "),a("div",{staticClass:"language-conf extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("server {\n    server_name www.yoursite.com yoursite.com;\n\n    # 需要添加的配置\n    location ^~ /.well-known/acme-challenge/ {\n        alias /home/xxx/www/challenges/;\n        try_files $uri =404;\n    }\n\n    # ... 其它配置\n}\n\n")])])]),a("h4",{attrs:{id:"standalone"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#standalone"}},[e._v("#")]),e._v(" standalone")]),e._v(" "),a("p",[a("code",[e._v("certbot standalone")]),e._v(" 该插件会启动一个web服务器,如已经运行了nginx服务并且占用了80，433的话需要暂时停止。")]),e._v(" "),a("p",[e._v("使用"),a("code",[e._v("--preferred-challenges http")]),e._v("参数的话，对应使用80端口")]),e._v(" "),a("p",[e._v("使用"),a("code",[e._v("--preferred-challenges tls-sni")]),e._v("参数对应使用443端口，所以如果你有占用这两个端口的服务")]),e._v(" "),a("p",[e._v("请根据你的实际使用端口，停用占用端口的程序，同样配合certonly使用。")]),e._v(" "),a("p",[e._v("使用方法：")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token function"}},[e._v("sudo")]),e._v(" certbot certonly --standalone -d example.com -d www.example.com\n")])])]),a("h4",{attrs:{id:"dns-plugins"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dns-plugins"}},[e._v("#")]),e._v(" DNS plugins")]),e._v(" "),a("p",[e._v("如果你想去的一个野卡证书，那么只能使用dns验证的方式（即使你是使用manual参数，根本上还是使用dns验证方式）。")]),e._v(" "),a("p",[e._v("默认的certbot是不包含dns插件的，如果你要使用此方式的话，需要下载相应的插件：插件地址，具体的使用方法，请点击你对应的dns服务商链接，然后按照相应的方法获取证书，官方提供的基本上是国外的dns服务区上，国内的服务商暂时没有，不过可以使用manual方法。")]),e._v(" "),a("h4",{attrs:{id:"manual"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#manual"}},[e._v("#")]),e._v(" manual")]),e._v(" "),a("p",[e._v("该方法允许你通过交互的方式获取证书，可以在其它服务器上运行，可以选择http，dns和tls-sni方式中的任意一种。")]),e._v(" "),a("p",[e._v("比如使用dns的方式，会要求你在验证过程中手动填写txt dns的记录，然后继续，验证成功后会获取证书。")]),e._v(" "),a("p",[e._v("举例：")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 使用manual方式，选择dns验证，申请野卡证书的方法（添加--server https://acme-v02.api.letsencrypt.org/directory参数）")]),e._v("\n./certbot-auto certonly  -d *.archerwong.cn -d archerwong.cn --manual --preferred-challenges dns --server https://acme-v02.api.letsencrypt.org/directory \n")])])]),a("p",[e._v("上面是手动的方式申请，中间需要人工干预，去dns服务商填写text记录。")]),e._v(" "),a("p",[e._v("你还可以使用脚本帮助你完成一些验证，可以使用--manual-auth-hook 和 --manual-cleanup-hook参数，关于钩子的使用：参考地址")]),e._v(" "),a("p",[e._v("正是因为这个钩子，可以编写一个 Shell 脚本，让脚本调用 DNS 服务商的 API 接口，动态添加 TXT 记录，这样就无需人工干预了。")]),e._v(" "),a("p",[e._v("推荐下 ："),a("a",{attrs:{href:"https://github.com/ywdblog/certbot-letencrypt-wildcardcertificates-alydns-au",target:"_blank",rel:"noopener noreferrer"}},[e._v("申请dns证书的脚本"),a("OutboundLink")],1)]),e._v(" "),a("h3",{attrs:{id:"证书管理"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#证书管理"}},[e._v("#")]),e._v(" 证书管理")]),e._v(" "),a("h4",{attrs:{id:"查看已经申请的证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#查看已经申请的证书"}},[e._v("#")]),e._v(" 查看已经申请的证书")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ ./certbot certificates\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nFound the following certs:\n  Certificate Name: *.leoliuge.com\n    Domains: *.leoliuge.com leoliuge.com\n    Expiry Date: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2020")]),e._v("-02-18 02:38:10+00:00 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("VALID: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("89")]),e._v(" days"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n    Certificate Path: /etc/letsencrypt/live/*.leoliuge.com/fullchain.pem\n    Private Key Path: /etc/letsencrypt/live/*.leoliuge.com/privkey.pem\n  Certificate Name: leoliuge.com\n    Domains: *.leoliuge.com\n    Expiry Date: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2020")]),e._v("-02-18 02:32:43+00:00 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("VALID: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("89")]),e._v(" days"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n    Certificate Path: /etc/letsencrypt/live/leoliuge.com/fullchain.pem\n    Private Key Path: /etc/letsencrypt/live/leoliuge.com/privkey.pem\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n")])])]),a("p",[a("code",[e._v("Certificate Name")]),e._v("是一个重要标识，可以具体指定哪一个证书，可以配合 run, certonly, certificates, renew，和 delete等命令一起使用")]),e._v(" "),a("p",[e._v("比如：")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("certbot certonly --cert-name archerwong.cn\n")])])]),a("h4",{attrs:{id:"重新创建和更新证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#重新创建和更新证书"}},[e._v("#")]),e._v(" 重新创建和更新证书")]),e._v(" "),a("p",[e._v("可以使用"),a("code",[e._v("certonly")]),e._v("或"),a("code",[e._v("run")]),e._v("命令来创建一个新证书，即使已经存在具有该域名的证书，也没有关系，那么certbot会更新该证书，否则会创建一个新证书，一句话存在就更新，不存在就创建")]),e._v(" "),a("p",[a("code",[e._v("run")]),e._v(" 和 "),a("code",[e._v("certonly")]),e._v("的区别：")]),e._v(" "),a("ul",[a("li",[a("p",[a("code",[e._v("run")]),e._v(" 默认的方式，获取，并安装一个证书")])]),e._v(" "),a("li",[a("p",[a("code",[e._v("certonly")]),e._v(" 是创建或者更新一个证书，但是不安装该证书")]),e._v(" "),a("ul",[a("li",[e._v("在recreate证书的时候，可以指定具体行为，可以使用"),a("code",[e._v("--force-renewal")]),e._v(", "),a("code",[e._v("--duplicate")]),e._v(", "),a("code",[e._v("--expand")]),e._v("来限定操作，如果你没有具体指定，certbot可能会问你具体意图。")])])]),e._v(" "),a("li",[a("p",[a("code",[e._v("--force-renewal")]),e._v(" 当请求一个已经存在并有相同域名的证书时，需要把每一个域名通过-d来指定，不管过期与否，强制更新证书。")])]),e._v(" "),a("li",[a("p",[a("code",[e._v("--duplicate")]),e._v(" 告诉certbot不管有没有旧证书，都创建一个独立的新证书")])]),e._v(" "),a("li",[a("p",[a("code",[e._v("--expand")]),e._v(" 告诉certbot更新一个已经存在的证书，需要使用-d参数包含所有旧的域名，并添加新的域名。")])])]),e._v(" "),a("p",[e._v("expand 举例")]),e._v(" "),a("p",[e._v("可以将域名使用逗号分隔")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("certbot --expand -d existing.com,example.com,newdomain.com\n")])])]),a("p",[e._v("也可以单独写")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("certbot --expand -d existing.com -d example.com -d newdomain.com\n")])])]),a("p",[e._v("当我们需要扩展一个证书的时候，上面是通过expand方式，并且是通过-d参数来判定是哪个证书的，但是官方鼓励使用--cert-name来指明是哪个证书，不建议使用expand。")]),e._v(" "),a("h4",{attrs:{id:"改变证书的域名"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#改变证书的域名"}},[e._v("#")]),e._v(" 改变证书的域名")]),e._v(" "),a("p",[e._v("同样可以通过指定"),a("code",[e._v("--cert-name")]),e._v("的方式来更改证书的域名，形式如下")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("certbot certonly --cert-name example.com -d example.com\ncertbot certonly --cert-name example.com -d example.org,www.example.org\n")])])]),a("h4",{attrs:{id:"撤销证书（revoking-certificates）"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#撤销证书（revoking-certificates）"}},[e._v("#")]),e._v(" 撤销证书（revoking certificates）")]),e._v(" "),a("p",[e._v("如果你的证书秘钥已经被泄露，那么可以选择撤销证书，使用revoke命令，注意这里配合使用的参数是证书路径（以cert.pem结尾），不是证书名称或者域名")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("certbot revoke --cert-path /etc/letsencrypt/live/CERTNAME/cert.pem --reason keycompromise\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 同时可以指定原因，可以使用的原因包括:")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# unspecified （默认）， keycompromise, affiliationchanged, superseded, 和 cessationofoperation")]),e._v("\n")])])]),a("p",[e._v("如果证书是使用 "),a("code",[e._v("--staging")]),e._v(" 或 "),a("code",[e._v("--test-cert")]),e._v(" 参数，那么当revoke证书的时候需要带着测试参数 "),a("code",[e._v("--staging")]),e._v(" 或 "),a("code",[e._v("--test-cert")])]),e._v(" "),a("p",[e._v("因为证书申请是有数目限制的，所以后面我加上了测试用的参数，可以看下申请出的证书过期时间是和正式证书不同的")]),e._v(" "),a("p",[e._v("一旦证书被revoke后，可以使用delete命令删除证书。")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("certbot delete --cert-name example.com\n")])])]),a("p",[e._v("注意：如果你revoke一个证书，那么如果不delete的话，当renew的时候该证书仍然会被更新。")]),e._v(" "),a("p",[e._v("下面演示如何删除一个证书")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ ./certbot-auto revoke --cert-path /etc/letsencrypt/live/test.archerwong.cn-0001/cert.pem --staging --reason keycompromise\nSaving debug log to /var/log/letsencrypt/letsencrypt.log\n\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nWould you like to delete the cert"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("s"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" you just revoked?\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# 询问你是否删除revoke的证书，要删除就选输入Y")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("Y"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("es "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("recommended"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("/"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("N"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("o: n\n\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\nCongratulations"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("!")]),e._v(" You have successfully revoked the certificate that was located\nat /etc/letsencrypt/live/test.archerwong.cn-0001/cert.pem\n\n- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -\n\nIMPORTANT NOTES:\n - Not deleting revoked certs.\n\n")])])]),a("h4",{attrs:{id:"更新证书"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#更新证书"}},[e._v("#")]),e._v(" 更新证书")]),e._v(" "),a("p",[e._v("处于安全等因素的考虑，letsencrypt证书只支持90天的有效期，所以我们需要在临近过期的时间再次更新证书，certbot上可以方便的进行更新操作,使用renew命令")]),e._v(" "),a("p",[e._v("certbot renew\n类似于下面的情形，因为我都是新申请的证书，所以没有更新")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ ./certbot renew\n\n")])])]),a("p",[e._v("该命令会尝试更新所有的证书，查找到期天数低于30天的证书，然后更新\n，正式因为上面的特性，当没有需要更新的证书的时候，就不会采取任何操作，所以这特别适合自动部署，你可以频繁的进行renew操作，不用担心产生太多副作用。")]),e._v(" "),a("p",[e._v("这里还有个强大的功能就是可以使用钩子，比如你使用的是standalone方式验证证书，同时你又时刻运行着自己的nginx服务器，那么当验证的时候就需要关闭nginx服务，这时候就可以使用钩子来自动化完成这个操作，当有证书需要更新的时候才会触发钩子，不是每运行一次更新操作就运行一次钩子，所以不用太担心会频繁关闭启动nginx服务。")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("certbot renew --pre-hook "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"service nginx stop"')]),e._v(" --post-hook "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"service nginx start"')]),e._v("\n")])])]),a("p",[a("code",[e._v("--pre-hook")]),e._v(" 和"),a("code",[e._v("--post-hook")]),e._v(" 钩子运行在尝试更新和更新证书之后")]),e._v(" "),a("p",[e._v("如果你想要只运行在一次成功更新证书之后，那么可以使用"),a("code",[e._v("--deploy-hook")])]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("certbot renew --deploy-hook /path/to/deploy-hook-script\n")])])]),a("p",[e._v("比如，你有一个守护进程需要读取证书内容但是不是使用root用户，下面的脚本可以复制一份证书，并更改证书的权限。")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token shebang important"}},[e._v("#!/bin/sh")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("set")]),e._v(" -e\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("for")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token for-or-select variable"}},[e._v("domain")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$RENEWED_DOMAINS")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("do")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("case")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$domain")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("in")]),e._v("\n        example.com"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n                "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("daemon_cert_root")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("/etc/some-daemon/certs\n\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Make sure the certificate and private key files are")]),e._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# never world readable, even just for an instant while")]),e._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# we're copying them into daemon_cert_root.")]),e._v("\n                "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("umask")]),e._v(" 077\n\n                "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("cp")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$RENEWED_LINEAGE")]),e._v('/fullchain.pem"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$daemon_cert_root")]),e._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$domain")]),e._v('.cert"')]),e._v("\n                "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("cp")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$RENEWED_LINEAGE")]),e._v('/privkey.pem"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$daemon_cert_root")]),e._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$domain")]),e._v('.key"')]),e._v("\n\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Apply the proper file ownership and permissions for")]),e._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# the daemon to read its certificate and key.")]),e._v("\n                "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("chown")]),e._v(" some-daemon "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$daemon_cert_root")]),e._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$domain")]),e._v('.cert"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n                        "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$daemon_cert_root")]),e._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$domain")]),e._v('.key"')]),e._v("\n                "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("chmod")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("400")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$daemon_cert_root")]),e._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$domain")]),e._v('.cert"')]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("\\")]),e._v("\n                        "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"'),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$daemon_cert_root")]),e._v("/"),a("span",{pre:!0,attrs:{class:"token variable"}},[e._v("$domain")]),e._v('.key"')]),e._v("\n\n                "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("service")]),e._v(" some-daemon restart "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(">")]),e._v("/dev/null\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("esac")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("done")]),e._v("\n\n")])])]),a("p",[e._v("你可以直接将钩子文件放到指定目录 "),a("code",[e._v("/etc/letsencrypt/renewal-hooks/pre")]),e._v(", "),a("code",[e._v("/etc/letsencrypt/renewal-hooks/deploy")]),e._v(", "),a("code",[e._v("/etc/letsencrypt/renewal-hooks/post")]),e._v("，那么这三个文件夹里的文件会按照，pre，deply，post类型的钩子运行。同一个文件夹下有多个文件，那么这些文件的运行时按照文件名字母的排序先后运行的。你可以指定不使用这些文件夹下的钩子文件，需要在使用命令的时候添加 "),a("code",[e._v("--no-directory-hooks")]),e._v(" 参数")]),e._v(" "),a("p",[e._v("如果在更新证书的过程中不需要人工干预，那么可以将命令添加到crontab，这样定期自动更新证书。")]),e._v(" "),a("p",[e._v("如果你在手动更新证书，并且向忽略过期时间的限制，那么可以使用 --force-renewal 参数，但是这样做要注意，你可能很快就超过官方申请频率的限制。")]),e._v(" "),a("p",[e._v("如果你不想在申请过程中有任何输入，那么可以使用--noninteractive (简写：-n)来表名不想输入，这时客户端会尝试帮你填写需要的选项。")]),e._v(" "),a("p",[e._v("如果快到期的时候你还没有更新证书，那么CA会给你发邮件提醒你，所以邮箱还是要认真填写的。")]),e._v(" "),a("h3",{attrs:{id:"certbot-help"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#certbot-help"}},[e._v("#")]),e._v(" certbot help")]),e._v(" "),a("p",[e._v("Certbot 0.12.0")]),e._v(" "),a("div",{staticClass:"language-conf extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("用法:\n  certbot [子命令] [选项] [-d 域名] [-d 域名] ...\nCertbot工具用于获取和安装 HTTPS/TLS/SSL 证书。默认情况下，Certbot会尝试为本地网页服务器\n(如果不存在会默认安装一个到本地)获取并安装证书。最常用的子命令和选项如下:\n\n获取, 安装, 更新证书:\n    (默认) run       获取并安装证书到当前网页服务器\n    certonly        获取或更新证书，但是不安装\n    renew           更新已经获取但快过期的所有证书\n   -d 域名列表        指定证书对应的域名列表，域名之间使用逗号分隔\n\n  --apache          使用Apache插件进行身份认证和安装\n  --standalone      运行一个独立的网页服务器用于身份认证\n  --nginx           使用Nginx插件进行身份认证和安装\n  --webroot         把身份认证文件放置在服务器的网页根目录下\n  --manual          使用交互式或脚本钩子的方式获取证书\n\n   -n               非交互式运行\n  --test-cert       从预交付服务器上获取测试证书\n  --dry-run         测试获取或更新证书，但是不存储到本地硬盘\n\n证书管理:\n    certificates    显示使用Certbot生成的所有证书的信息\n    revoke          撤销证书(supply --cert-path)\n    delete          删除证书\n\n管理你的Let's Encrypt账户\n    register        创建Let's Encrypt ACME账户\n  --agree-tos       同意ACME服务器的订阅协议\n   -m EMAIL         接收有关账户的重要通知的邮箱地址\n\n可选参数:\n  -h, --help            显示帮助信息，然后退出\n  -c 配置文件, --config 配置文件\n                        配置文件的路径 (默认: /etc/letsencrypt/cli.ini\n                        或 ~/.config/letsencrypt/cli.ini)\n  -v, --verbose         当前参数可以重复使用多次来增加输出信息的详细程度，例如 -vvv.\n                        (默认: -2)\n  -n, --non-interactive, --noninteractive\n                        非交互式运行，即运行过程中不需要询问用户输入，但需要额外的命令行\n                        参数。当客户端发现参数缺失时会给出相应的说明。(默认: False)\n  --force-interactive   无论Certbot是否以命令行的方式运行，强制交互式运行。当前参数不能\n                        用于renew子命令。(默认: False)\n  -d 域名列表, --domains 域名列表, --domain 域名列表\n                        指定域名列表。如果有多个域名，可以多次使用-d参数，也可以在-d参数后\n                        使用逗号分隔的域名列表。(默认: 询问)\n  --cert-name 证书名称   指定证书名称。每次Certbot运行只使用一个证书名称。可以使用命令\n                        'certbot certificates'查看已生成的证书名称。当创建新的证书时，\n                        此选项用于指定证书的名称。(默认: 无)\n  --dry-run             使用客户端执行一次试运行，获取测试证书(无效的证书)但不保存到磁盘。\n                        当前选项仅用于'certonly'和'renew'子命令。\n                        注: 尽管 --dry-run 选项试图阻止任何对系统的修改，但并不能做到\n                        完全避免: 如果使用类似apache或nginx网页服务器来认证插件，\n                        程序运行过程中，会尝试修改或恢复配置文件来获取测试证书，\n                        也会重启网页服务器来部署和回滚这些修改。如果定义了 --pre-hook 和\n                        --post-hook 选项它们会被同时执行，这两个选项有助于更精确地模拟\n                        更新证书。--renew-hook 选项在这里不会被执行。(默认: False)\n  --preferred-challenges PREF_CHALLS\n                        A sorted, comma delimited list of the preferred\n                        challenge to use during authorization with the most\n                        preferred challenge listed first (Eg, \"dns\" or \"tls-\n                        sni-01,http,dns\"). Not all plugins support all\n                        challenges. See\n                        https://certbot.eff.org/docs/using.html#plugins for\n                        details. ACME Challenges are versioned, but if you\n                        pick \"http\" rather than \"http-01\", Certbot will select\n                        the latest version automatically. (default: [])\n  --user-agent 用户代理\n                        设置本客户端的用户代理信息。用户代理信息用于CA机构收集关于操作系统\n                        和插件的使用成功率。如果你希望隐藏此信息，设置此选项为\"\"。\n                        (默认: CertbotACMEClient/0.12.0 (Ubuntu 16.04.2 LTS)\n                        Authenticator/XXX Installer/YYY)\n\n自动化:\n  用于自动运行或其他情况的参数\n\n  --keep-until-expiring, --keep, --reinstall\n                        如果被请求的证书已经存在，那么不执行更新操作直到证书将要过期\n                        (如果使用了'run'子命令，无论是否过期证书都会被更新)。\n                        (默认: 询问)\n  --expand              如果请求的证书名字是已经存在的证书名字的子集，那么这个本地证书\n                        会被重置并重命名。(默认: 询问)\n  --version             显示程序和版本号，然后退出\n  --force-renewal, --renew-by-default\n                        如果请求的证书已经存在，无论是否快要到期，更新该证书。\n                        (通常使用 --keep-until-expiring 选项)。\n                        该选项默认包含了 --expand 选项的功能。(默认: False)\n  --renew-with-new-domains\n                        如果被请求的证书已经存在，但是域名变了，那么无论该证书是否将要过期\n                        都会被更新。(默认: False)\n  --allow-subset-of-names\n                        When performing domain validation, do not consider it\n                        a failure if authorizations can not be obtained for a\n                        strict subset of the requested domains. This may be\n                        useful for allowing renewals for multiple domains to\n                        succeed even if some domains no longer point at this\n                        system. This option cannot be used with --csr.\n                        (default: False)\n  --agree-tos           同意ACME订阅协议 (默认: 询问)\n  --duplicate           Allow making a certificate lineage that duplicates an\n                        existing one (both can be renewed in parallel)\n                        (default: False)\n  --os-packages-only    (仅用于 certbot-auto) 安装系统依赖包，然后停止 (默认: False)\n  --no-self-upgrade     (仅用于 certbot-auto) 禁止 certbot-auto 脚本自动升级自己到\n                        新的发布版本 (默认: 自动升级)\n  -q, --quiet           程序运行只输出错误信息。这个选项对于 cron 等自动化工具很有用。\n                        该选项默认包含了 --non-interactive 选项的功能。(默认: False)\n\n安全:\n  有关安全的参数和服务器设置\n\n  --rsa-key-size N      RSA密钥的大小。 (默认: 2048)\n  --must-staple         为证书添加 OCSP Must Staple 扩展。当Apache版本高于2.3.3时，\n                        自动配置 OCSP Stapling 支持。 (默认: False)\n  --redirect            对于新认证的虚拟主机，自动重定向HTTP到HTTPS。 (默认: 询问)\n  --no-redirect         对于新认证的虚拟主机，不要重定向HTTP到HTTPS。 (默认: 询问)\n  --hsts                Add the Strict-Transport-Security header to every HTTP\n                        response. Forcing browser to always use SSL for the\n                        domain. Defends against SSL Stripping. (default:\n                        False)\n  --uir                 Add the \"Content-Security-Policy: upgrade-insecure-\n                        requests\" header to every HTTP response. Forcing the\n                        browser to use https:// for every http:// resource.\n                        (default: None)\n  --staple-ocsp         Enables OCSP Stapling. A valid OCSP response is\n                        stapled to the certificate that the server offers\n                        during TLS. (default: None)\n  --strict-permissions  Require that all configuration files are owned by the\n                        current user; only needed if your config is somewhere\n                        unsafe like /tmp/ (default: False)\n\n测试:\n  The following flags are meant for testing and integration purposes only.\n\n  --test-cert, --staging\n                        Use the staging server to obtain or revoke test\n                        (invalid) certs; equivalent to --server https://acme-\n                        staging.api.letsencrypt.org/directory (default: False)\n  --debug               Show tracebacks in case of errors, and allow certbot-\n                        auto execution on experimental platforms (default:\n                        False)\n  --no-verify-ssl       Disable verification of the ACME server's certificate.\n                        (default: False)\n  --tls-sni-01-port TLS_SNI_01_PORT\n                        Port used during tls-sni-01 challenge. This only\n                        affects the port Certbot listens on. A conforming ACME\n                        server will still attempt to connect on port 443.\n                        (default: 443)\n  --http-01-port HTTP01_PORT\n                        Port used in the http-01 challenge. This only affects\n                        the port Certbot listens on. A conforming ACME server\n                        will still attempt to connect on port 80. (default:\n                        80)\n  --break-my-certs      Be willing to replace or renew valid certs with\n                        invalid (testing/staging) certs (default: False)\n\n路径:\n  修改有关执行路径和服务器的参数\n\n  --cert-path 证书路径\n                        Path to where cert is saved (with auth --csr),\n                        installed from, or revoked. (default: None)\n  --key-path 密钥路径    Path to private key for cert installation or\n                        revocation (if account key is missing) (default: None)\n  --chain-path 钥匙链路径\n                        Accompanying path to a certificate chain. (default:\n                        None)\n  --config-dir 配置文件目录\n                        Configuration directory. (default: /etc/letsencrypt)\n  --work-dir 工作目录    Working directory. (default: /var/lib/letsencrypt)\n  --logs-dir 日志目录    Logs directory. (default: /var/log/letsencrypt)\n  --server 服务器        ACME Directory Resource URI. (default:\n                        https://acme-v01.api.letsencrypt.org/directory)\n\n管理:\n  Various subcommands and flags are available for managing your\n  certificates:\n\n  certificates          List certificates managed by Certbot\n  delete                Clean up all files related to a certificate\n  renew                 Renew all certificates (or one specified with --cert-\n                        name)\n  revoke                Revoke a certificate specified with --cert-path\n  update_symlinks       Recreate symlinks in your /etc/letsencrypt/live/\n                        directory\n\nrun:\n  获取和安装证书的选项\n\ncertonly:\n  修改获取证书方式的选项\n\n  --csr CSR             Path to a Certificate Signing Request (CSR) in DER or\n                        PEM format. Currently --csr only works with the\n                        'certonly' subcommand. (default: None)\n\nrenew:\n  The 'renew' subcommand will attempt to renew all certificates (or more\n  precisely, certificate lineages) you have previously obtained if they are\n  close to expiry, and print a summary of the results. By default, 'renew'\n  will reuse the options used to create obtain or most recently successfully\n  renew each certificate lineage. You can try it with `--dry-run` first. For\n  more fine-grained control, you can renew individual lineages with the\n  `certonly` subcommand. Hooks are available to run commands before and\n  after renewal; see https://certbot.eff.org/docs/using.html#renewal for\n  more information on these.\n\n  --pre-hook PRE_HOOK   Command to be run in a shell before obtaining any\n                        certificates. Intended primarily for renewal, where it\n                        can be used to temporarily shut down a webserver that\n                        might conflict with the standalone plugin. This will\n                        only be called if a certificate is actually to be\n                        obtained/renewed. When renewing several certificates\n                        that have identical pre-hooks, only the first will be\n                        executed. (default: None)\n  --post-hook POST_HOOK\n                        Command to be run in a shell after attempting to\n                        obtain/renew certificates. Can be used to deploy\n                        renewed certificates, or to restart any servers that\n                        were stopped by --pre-hook. This is only run if an\n                        attempt was made to obtain/renew a certificate. If\n                        multiple renewed certificates have identical post-\n                        hooks, only one will be run. (default: None)\n  --renew-hook RENEW_HOOK\n                        Command to be run in a shell once for each\n                        successfully renewed certificate. For this command,\n                        the shell variable $RENEWED_LINEAGE will point to the\n                        config live subdirectory containing the new certs and\n                        keys; the shell variable $RENEWED_DOMAINS will contain\n                        a space-delimited list of renewed cert domains\n                        (default: None)\n  --disable-hook-validation\n                        Ordinarily the commands specified for --pre-hook\n                        /--post-hook/--renew-hook will be checked for\n                        validity, to see if the programs being run are in the\n                        $PATH, so that mistakes can be caught early, even when\n                        the hooks aren't being run just yet. The validation is\n                        rather simplistic and fails if you use more advanced\n                        shell constructs, so you can use this switch to\n                        disable it. (default: False)\n\ncertificates:\n  列出由Certbot管理的所有证书信息\n\ndelete:\n  用于删除证书的选项\n\nrevoke:\n  用于撤销证书的选项\n\n  --reason {keycompromise,affiliationchanged,superseded,unspecified,cessationofoperation}\n                        Specify reason for revoking certificate. (default: 0)\n\nregister:\n  用于账户注册和更新的选项\n\n  --register-unsafely-without-email\n                        Specifying this flag enables registering an account\n                        with no email address. This is strongly discouraged,\n                        because in the event of key loss or account compromise\n                        you will irrevocably lose access to your account. You\n                        will also be unable to receive notice about impending\n                        expiration or revocation of your certificates. Updates\n                        to the Subscriber Agreement will still affect you, and\n                        will be effective 14 days after posting an update to\n                        the web site. (default: False)\n  --update-registration\n                        With the register verb, indicates that details\n                        associated with an existing registration, such as the\n                        e-mail address, should be updated, rather than\n                        registering a new account. (default: False)\n  -m EMAIL, --email EMAIL\n                        Email used for registration and recovery contact.\n                        (default: Ask)\n  --eff-email           Share your e-mail address with EFF (default: None)\n  --no-eff-email        Don't share your e-mail address with EFF (default:\n                        None)\n\nunregister:\n  用于注销账户的选项\n\n  --account 账户ID       需要注销的账户ID (默认: 无)\n\ninstall:\n  用于修改证书部署路径的选项\n\n  --fullchain-path 完整钥匙链的路径\n                        Accompanying path to a full certificate chain (cert\n                        plus chain). (default: None)\n\nconfig_changes:\n  Options for controlling which changes are displayed\n\n  --num NUM             How many past revisions you want to be displayed\n                        (default: None)\n\nrollback:\n  Options for rolling back server configuration changes\n\n  --checkpoints N       Revert configuration N number of checkpoints.\n                        (default: 1)\n\nplugins:\n  Options for for the \"plugins\" subcommand\n\n  --init                Initialize plugins. (default: False)\n  --prepare             Initialize and prepare plugins. (default: False)\n  --authenticators      Limit to authenticator plugins only. (default: None)\n  --installers          Limit to installer plugins only. (default: None)\n\nupdate_symlinks:\n  Recreates cert and key symlinks in /etc/letsencrypt/live, if you changed\n  them by hand or edited a renewal configuration file\n\nplugins:\n  Plugin Selection: Certbot client supports an extensible plugins\n  architecture. See 'certbot plugins' for a list of all installed plugins\n  and their names. You can force a particular plugin by setting options\n  provided below. Running --help <plugin_name> will list flags specific to\n  that plugin.\n\n  --configurator CONFIGURATOR\n                        Name of the plugin that is both an authenticator and\n                        an installer. Should not be used together with\n                        --authenticator or --installer. (default: Ask)\n  -a AUTHENTICATOR, --authenticator AUTHENTICATOR\n                        Authenticator plugin name. (default: None)\n  -i INSTALLER, --installer INSTALLER\n                        Installer plugin name (also used to find domains).\n                        (default: None)\n  --apache              Obtain and install certs using Apache (default: False)\n  --nginx               Obtain and install certs using Nginx (default: False)\n  --standalone          运行一个独立的网页服务器用于获取证书。(默认: False)\n  --manual              Provide laborious manual instructions for obtaining a\n                        cert (default: False)\n  --webroot             把身份认证文件放置在服务器的网页根目录下用于获取证书。\n                        (默认: False)\n\nnginx:\n  Nginx网页服务器插件 - Alpha版本\n\n  --nginx-server-root NGINX_SERVER_ROOT\n                        Nginx server root directory. (default: /etc/nginx)\n  --nginx-ctl NGINX_CTL\n                        Path to the 'nginx' binary, used for 'configtest' and\n                        retrieving nginx version number. (default: nginx)\n\nstandalone:\n  启动一个临时的网页服务器\n\nmanual:\n  Authenticate through manual configuration or custom shell scripts. When\n  using shell scripts, an authenticator script must be provided. The\n  environment variables available to this script are $CERTBOT_DOMAIN which\n  contains the domain being authenticated, $CERTBOT_VALIDATION which is the\n  validation string, and $CERTBOT_TOKEN which is the filename of the\n  resource requested when performing an HTTP-01 challenge. An additional\n  cleanup script can also be provided and can use the additional variable\n  $CERTBOT_AUTH_OUTPUT which contains the stdout output from the auth\n  script.\n\n  --manual-auth-hook MANUAL_AUTH_HOOK\n                        Path or command to execute for the authentication\n                        script (default: None)\n  --manual-cleanup-hook MANUAL_CLEANUP_HOOK\n                        Path or command to execute for the cleanup script\n                        (default: None)\n  --manual-public-ip-logging-ok\n                        Automatically allows public IP logging (default: Ask)\n\nwebroot:\n  Place files in webroot directory\n\n  --webroot-path WEBROOT_PATH, -w WEBROOT_PATH\n                        public_html / webroot path. This can be specified\n                        multiple times to handle different domains; each\n                        domain will have the webroot path that preceded it.\n                        For instance: `-w /var/www/example -d example.com -d\n                        www.example.com -w /var/www/thing -d thing.net -d\n                        m.thing.net` (default: Ask)\n  --webroot-map WEBROOT_MAP\n                        JSON dictionary mapping domains to webroot paths; this\n                        implies -d for each entry. You may need to escape this\n                        from your shell. E.g.: --webroot-map\n                        '{\"eg1.is,m.eg1.is\":\"/www/eg1/\", \"eg2.is\":\"/www/eg2\"}'\n                        This option is merged with, but takes precedence over,\n                        -w / -d entries. At present, if you put webroot-map in\n                        a config file, it needs to be on a single line, like:\n                        webroot-map = {\"example.com\":\"/var/www\"}. (default:\n                        {})\n\napache:\n  Apache网页服务器插件 - Beta版本\n\n  --apache-enmod APACHE_ENMOD\n                        Path to the Apache 'a2enmod' binary. (default:\n                        a2enmod)\n  --apache-dismod APACHE_DISMOD\n                        Path to the Apache 'a2dismod' binary. (default:\n                        a2dismod)\n  --apache-le-vhost-ext APACHE_LE_VHOST_EXT\n                        SSL vhost configuration extension. (default: -le-\n                        ssl.conf)\n  --apache-server-root APACHE_SERVER_ROOT\n                        Apache server root directory. (default: /etc/apache2)\n  --apache-vhost-root APACHE_VHOST_ROOT\n                        Apache server VirtualHost configuration root (default:\n                        /etc/apache2/sites-available)\n  --apache-logs-root APACHE_LOGS_ROOT\n                        Apache server logs directory (default:\n                        /var/log/apache2)\n  --apache-challenge-location APACHE_CHALLENGE_LOCATION\n                        Directory path for challenge configuration. (default:\n                        /etc/apache2)\n  --apache-handle-modules APACHE_HANDLE_MODULES\n                        Let installer handle enabling required modules for\n                        you.(Only Ubuntu/Debian currently) (default: True)\n  --apache-handle-sites APACHE_HANDLE_SITES\n                        Let installer handle enabling sites for you.(Only\n                        Ubuntu/Debian currently) (default: True)\nnull:\n  Null Installer\n")])])])])}),[],!1,null,null,null);t.default=s.exports}}]);